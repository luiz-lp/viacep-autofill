<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Exemplo ViaCEP Autofill</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; }
    input { display: block; margin: 0.5rem 0; padding: 0.5rem; width: 200px; }
    .loading { color: blue; }
    .error { color: red; }
    .success { color: green; }
  </style>
</head>
<body>
  <h1>Teste ViaCEP Autofill</h1>

  <form>
    <input id="cep" placeholder="CEP" />
    <input id="rua" data-viacep="logradouro" placeholder="Rua" />
    <input id="bairro" data-viacep="bairro" placeholder="Bairro" />
    <input id="cidade" data-viacep="localidade" placeholder="Cidade" />
    <input id="uf" data-viacep="uf" maxlength="2" placeholder="UF" />
  </form>

  <p id="status"></p>

  <script src="../dist/viacep-autofill.global.js"></script>
  <script>
    const statusEl = document.getElementById('status');

    ViaCepAutofill.init({
      cep: '#cep',
      validateOnBlur: true,   // s√≥ mostra erro INVALID_CEP ao sair do campo
      fetchTimeout: 6000,     // ms
      retries: 2,             // tenta novamente 2 vezes
      retryBackoffBase: 300,  // 300ms, 600ms, ...
      fallback: true,         // tenta BrasilAPI se ViaCEP n√£o responder

      onStateChange: (state, payload) => {
        if (state === 'FETCHING') {
          statusEl.textContent = 'üîÑ Buscando informa√ß√µes do CEP...';
          statusEl.className = 'loading';
        }
        if (state === 'SUCCESS') {
          statusEl.textContent = '‚úÖ Endere√ßo preenchido com sucesso!';
          statusEl.className = 'success';
        }
        if (state === 'NOT_FOUND') {
          statusEl.textContent = '‚ùå CEP n√£o encontrado.';
          statusEl.className = 'error';
        }
      },

      onError: (err) => {
        const map = {
          INVALID_CEP: 'CEP inv√°lido. Use 8 d√≠gitos.',
          TIMEOUT: 'Tempo de resposta excedido.',
          RATE_LIMITED: 'Muitas consultas. Aguarde alguns segundos.',
          NETWORK: 'Falha de rede. Tente novamente.',
          PROVIDER: 'Erro no servi√ßo de CEP. Tente mais tarde.'
        };
        alert(map[err.code] || err.message || 'Erro inesperado');
        statusEl.textContent = map[err.code] || err.message || 'Erro inesperado';
        statusEl.className = 'error';
      }
    });
  </script>
</body>
</html>
